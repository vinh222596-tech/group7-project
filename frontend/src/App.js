import React, { useEffect, useState } from "react";
import axios from "axios";
import AddUser from "./AddUser";
import { ToastContainer, toast } from "react-toastify";
import "react-toastify/dist/ReactToastify.css";

function App() {
  const [users, setUsers] = useState([]);          // state danh s√°ch ng∆∞·ªùi d√πng
  const [editingUser, setEditingUser] = useState(null); // state ng∆∞·ªùi d√πng ƒëang edit
  const API_URL = "http://localhost:5000/users";

  // L·∫•y danh s√°ch ng∆∞·ªùi d√πng
  const fetchUsers = async () => {
    try {
      const res = await axios.get(API_URL);
      setUsers(res.data);
    } catch (err) {
      toast.error("‚ùå L·ªói khi t·∫£i danh s√°ch ng∆∞·ªùi d√πng");
    }
  };

  useEffect(() => {
    fetchUsers();
  }, []);

  // X√≥a ng∆∞·ªùi d√πng
  const handleDelete = async (_id) => {
    if (!window.confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ng∆∞·ªùi d√πng n√†y?")) return;
    try {
      await axios.delete(`${API_URL}/${_id}`);
      setUsers(users.filter((u) => u._id !== _id));
      toast.success("üóëÔ∏è X√≥a th√†nh c√¥ng!");
    } catch (err) {
      toast.error("‚ùå L·ªói khi x√≥a ng∆∞·ªùi d√πng");
    }
  };

  // Ch·ªçn ng∆∞·ªùi d√πng ƒë·ªÉ edit
  const handleEdit = (user) => setEditingUser(user);

  // C·∫≠p nh·∫≠t ng∆∞·ªùi d√πng
  const handleUpdate = async (updatedUser) => {
    try {
      await axios.put(`${API_URL}/${updatedUser._id}`, {
        name: updatedUser.name,
        email: updatedUser.email,
      });
      fetchUsers();
      setEditingUser(null);
      toast.success("‚úèÔ∏è C·∫≠p nh·∫≠t th√†nh c√¥ng!");
    } catch (err) {
      toast.error("‚ùå L·ªói khi c·∫≠p nh·∫≠t ng∆∞·ªùi d√πng");
    }
  };

  return (
    <div
      style={{
        minHeight: "100vh",
        background: "linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%)",
        display: "flex",
        flexDirection: "column",
        alignItems: "center",
        padding: "40px 20px",
        fontFamily: "'Poppins', sans-serif",
      }}
    >
      <AddUser
        fetchUsers={fetchUsers}
        editingUser={editingUser}
        onUpdate={handleUpdate}
        cancelEdit={() => setEditingUser(null)}
      />

      <div
        style={{
          marginTop: "30px",
          width: "100%",
          maxWidth: "600px",
          background: "rgba(255,255,255,0.25)",
          backdropFilter: "blur(12px)",
          borderRadius: "16px",
          boxShadow: "0 8px 32px rgba(0,0,0,0.2)",
          padding: "20px",
          color: "#333",
        }}
      >
        <h3 style={{ color: "#fff", textAlign: "center" }}>üìã Danh S√°ch Ng∆∞·ªùi D√πng</h3>
        {users.length === 0 ? (
          <p style={{ textAlign: "center", color: "#fff" }}>Ch∆∞a c√≥ ng∆∞·ªùi d√πng n√†o.</p>
        ) : (
          <ul style={{ listStyle: "none", padding: 0 }}>
            {users.map((u) => (
              <li
                key={u._id}
                style={{
                  backgroundColor: "rgba(255,255,255,0.9)",
                  margin: "10px 0",
                  padding: "10px 15px",
                  borderRadius: "10px",
                  display: "flex",
                  justifyContent: "space-between",
                  alignItems: "center",
                }}
              >
                <span>
                  <strong>{u.name}</strong> - {u.email}
                </span>
                <div style={{ display: "flex", gap: "8px" }}>
                  <button
                    onClick={() => handleEdit(u)}
                    style={{
                      background: "linear-gradient(90deg, #00b09b, #96c93d)",
                      border: "none",
                      borderRadius: "8px",
                      color: "#fff",
                      padding: "6px 12px",
                      cursor: "pointer",
                      fontWeight: "bold",
                    }}
                  >
                    S·ª≠a
                  </button>
                  <button
                    onClick={() => handleDelete(u._id)}
                    style={{
                      background: "linear-gradient(90deg, #ff5f6d, #ffc371)",
                      border: "none",
                      borderRadius: "8px",
                      color: "#fff",
                      padding: "6px 12px",
                      cursor: "pointer",
                      fontWeight: "bold",
                    }}
                  >
                    X√≥a
                  </button>
                </div>
              </li>
            ))}
          </ul>
        )}
      </div>

      <ToastContainer position="top-center" autoClose={2000} />
    </div>
  );
}

export default App;
